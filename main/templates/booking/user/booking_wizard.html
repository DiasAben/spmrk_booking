{% extends 'booking/user/base.html' %}
{% load static %}


{% block extra_css %}
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"> -->
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/material_blue.css">
{% endblock extra_css %}

{% block side_text %}
    <div class="booking-cta">
        <h1>{{title}}</h1>
        <p>{{description}}</p>
    </div>
{% endblock side_text %}

{% block steps %}
{% include 'booking/admin/components/show_errors.html' %}

<input type="hidden" id="available_booking_months" value="{{booking_settings.available_booking_months}}" />
<input type="hidden" id="disable_weekend" value="{{booking_settings.disable_weekend}}" />

<!-- steps START -->
<div class="tab-pane fade show active" id="pills-date" role="tabpanel" aria-labelledby="pills-date-tab">
    <h1 class="text-muted h2">{{wizard.steps.current}}</h1>
    <p class="text-muted">Please fill in the booking {{wizard.steps.current}}:</p>
    <hr>
    {{ wizard.management_form }}
    <div class="row">
        {% for field in wizard.form %}
            <div class="col-md-6 mb-3">
                <div class="form-floating {% if field.is_hidden %}d-none{% endif %}">
                    {{ field }}
                    <label for="{{field.id_for_label}}">{{ field.label }}</label>
                </div>
                <div id="calendar-events">
                </div>
            </div>
        {% endfor %}
    </div>
</div>
<!-- steps END -->

</div>


{% endblock steps %}

{% block extra_script %}
<script src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>
<script>
    // time functions START
    document.querySelectorAll("#time-list .bg-light, #time-list .bg-primary").forEach(timeBtn => {
        timeBtn.addEventListener("click", timeBtnClicked.bind(this, timeBtn))
    })

    function timeBtnClicked(item) {
        document.querySelectorAll("#time-list .bg-primary").forEach(item => {
            item.classList.remove("bg-primary", "text-white")
            item.classList.add("bg-light")
        })
        item.classList.remove("bg-light")
        item.classList.add("bg-primary", "text-white")

        document.querySelector("#id_Time-time").value = item.innerHTML
    }
    // time functions END
    var enable_dates = '{{enable_dates}}'
    enable_dates = enable_dates.replaceAll('&#x27;', '').replaceAll('[', '').replaceAll(']', '').replaceAll(' ', '')
    enable_dates = enable_dates.split(',')
    // Date Functions START
    var d = new Date();
    d.setMonth(d.getMonth() + document.querySelector("#available_booking_months").value);

    const disable_weekend = document.querySelector("#disable_weekend").value;
    function rmWeekend(date) {
        if (disable_weekend == "False") return ""
        if (d.getDate() == 2 || d.getDate() == 16) {
            return true;
        } else {
            return false;
       }
    }
    flatpickr.localize(flatpickr.l10ns.ru);
    let test_data = {{demo|safe}}
    let date_time = {}
    let eventDates
    for(var i of test_data){
        eventDates = Object.assign(date_time, i);
    }
    console.log(eventDates)
    flatpickr("#id_Date-date", {
            minDate: '2022-11-08',
            maxDate: d,
            enable: Object.keys(eventDates),
            shorthand: true,
            onChange: function(date, str, inst) {
                            var contents = '';
                            if(date.length) {
                                    contents += '<div class="event"><div class="date">' + flatpickr.formatDate(date[0], 'l J F') + '</div><div class="location">' + eventDates[str] + '</div></div>';

                            }
    $('#calendar-events').html(contents)
  },
            "locale": {
                "firstDayOfWeek": 1 // start week on Monday
            }
        })
        // Date Functions END
</script>
{% endblock extra_script %}
